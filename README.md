# ArtemisFgComposer

一款用于 **Artemis 视觉小说引擎** 的立绘批量合成工具，可以从PNG元数据或 Lua 脚本读取坐标信息，自动根据文件名规则对图片进行分类，组合生成所有的可能结果并批量合成，且支持位置信息回写用于二次合成。

## 使用方法

### 基本语法

```cmd
ArtemisFgComposer.exe [选项] <输入目录>
```

### 命令行选项

| 选项                | 简写        | 描述                                           |
| :------------------ | :---------- | :--------------------------------------------- |
| `--help`            | `-h`        | 显示帮助信息                                   |
| `--verbose`         | `-v`        | 输出详细日志                                   |
| `--write-pos-back`  | `-w`        | 将位置信息写回文件以二次合成                   |
| `--lua-path <路径>` | `-l <路径>` | 含有坐标信息的Lua脚本路径                      |
| `--output <路径>`   | `-o <路径>` | 输出目录，默认保存在输入目录同级的output文件夹 |
| `<输入目录>`        |             | 包含立绘部件的输入目录                         |

### 使用示例

```cmd
ArtemisFgComposer.exe ./input

ArtemisFgComposer.exe --output ./output ./input

ArtemisFgComposer.exe -v -w -l ./list_windows.tbl ./input

ArtemisFgComposer.exe --verbose --write-pos-back --lua-path ./coordinates.lua --output ./results ./character_parts
```

## 文件命名规则

工具根据以下规则对图片文件进行分类：

### 组分类规则

- 文件名匹配正则表达式：`([a-z]\d{4})`
- 使用文件名首字母作为组名（a-z）

### 部件分类规则

| 部件类型 | 正则表达式                        | 描述         |
| :------- | :-------------------------------- | :----------- |
| `base`   | `^[a-z]{3}_[a-z0-9]{2}[a-z]\d{4}` | 基础立绘部件 |
| `face`   | `^[a-z]\d{2}[0-8]\d`              | 面部表情部件 |
| `other`  | `^[a-z]\d{2}9\d`                  | 其他装饰部件 |

## 输入目录结构

输入目录应包含一组或多组立绘部件PNG文件：

```
no/
├── chr_noa0001.png
├── a0010.png
├── a0020.png
├── a9010.png
├── chr_nob0001.png
├── b0010.png
└── b9010.png
```

## 输出结果

工具会在输出目录生成所有可能的组合：

```
no_output/
├── chr_noa0001_a9010.png
├── chr_noa0001_a9010.png
├── chr_nob0001_b9010.png
└── ...
```

## Lua坐标文件格式

如果使用Lua坐标文件，应遵循以下格式：

```lua
fgpos = {
    tak_bca = {
        a0001 = {x = 457, y = 192},
        a0099 = {x = 464, y = 164},
        tak_bca0000 = {x = 341, y = 113},
        tak_bca0502 = {x = 331, y = 113},
    },
    tak_z2b = {
        b0001 = {x = 329, y = 226},
        b0099 = {x = 351, y = 158},
        tak_z2b0000 = {x = 177, y = 14},
        tak_z2b0502 = {x = 101, y = 14},
    },
}
```

**不建议更改立绘目录内所有文件夹的名称，否则可能会解析失败**

## **免责声明**

本工具仅供学习和研究使用，请勿用于商业用途。任何通过本工具获得的游戏资源，请遵守相关游戏的版权声明，不得随意传播和商用。
